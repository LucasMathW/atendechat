services:
  backend:
    build:
      context: .
      dockerfile: backend/Dockerfile
      args:
        STACK_NAME: ${STACK_NAME}
        ENABLE_FINANCIAL: ${ENABLE_FINANCIAL:-false}
        GERENCIANET_PIX_CERT: ${GERENCIANET_PIX_CERT:-production-cert}
    ports:
      - "${BACKEND_PORT:-3000}:3000"
    env_file:
      - .env
    depends_on:
      - postgres
      - redis
    deploy:
      resources:
        limits:
          cpus: "${BACKEND_CPU_LIMIT:-1.0}"
          memory: ${BACKEND_MEM_LIMIT:-512}M
    networks:
      - app-network

  frontend:
    build:
      context: .
      dockerfile: frontend/Dockerfile
    ports:
      - "${FRONTEND_PORT:-3001}:3001"
    depends_on:
      - backend
    deploy:
      resources:
        limits:
          cpus: "${FRONTEND_CPU_LIMIT:-0.5}"
          memory: ${FRONTEND_MEM_LIMIT:-256}M
    networks:
      - app-network
